<template>
  <div class="sign-up">
    <br />
    <div style="font-size: 150%; border: 15%; color: green">회 원 가 입</div>
    <br />
    <br />

    <div style="position: relative; left: -140px; color: green">I D )</div>
    <button
      v-on:click="idCheck"
      id="idCheckClear"
      style="
        position: relative;
        right: -350px;
        border: 1px solid black;
        width: 75pt;
        height: 35pt;
        visibility: visible;
      "
    >
      중복 확인
    </button>
    <img
      src="../../assets/loginComponentIMG/check.png"
      id="idClear"
      style="width: 1%; visibility: hidden; position: relative; right: -260px"
    />
    <input
      type="text"
      id="id"
      name="uid"
      v-model="user.userid"
      placeholder="E-mail 을 입력해주세요."
      style="position: relative; left: -77px"
    /><br /><br />

    <div style="position: relative; left: -125px; color: green">
      N A M E ) <br />
    </div>
    <img
      src="../../assets/loginComponentIMG/check.png"
      id="nameClear"
      style="width: 1%; visibility: hidden; position: relative; right: -400px"
    />
    <input
      type="text"
      value="* 한글만 입력해 주세요."
      id="nameFalse"
      style="
        width: 20%;
        position: relative;
        right: -380px;
        visibility: visible;
        font-weight: bold;
        border: 0px;
      "
      disabled
    />
    <input
      type="text"
      id="name"
      v-model="user.name"
      @keyup="nameCheck"
      placeholder="이름을 입력해주세요."
      style="position: relative; left: -139px"
    /><br /><br />

    <div style="position: relative; left: -140px; color: green">
      P W )<br />
    </div>
    <img
      src="../../assets/loginComponentIMG/check.png"
      id="pwClear"
      style="width: 1%; visibility: hidden; position: relative; right: -540px"
    />
    <input
      type="text"
      value="* 비밀번호는 영문,숫자,특수 문자 조합 4~15이내로 입력해주세요."
      id="pwFalse"
      style="
        width: 45%;
        position: relative;
        right: -520px;
        visibility: visible;
        font-weight: bold;
        border: 0px;
      "
      disabled
    />
    <input
      type="password"
      id="pw"
      name="upw"
      v-model="user.password"
      @keyup="pwCheck"
      style="position: relative; left: -279px"
      placeholder="PW를입력해주세요."
    /><br /><br />

    <div style="position: relative; left: -102px; color: green">
      C H E C K P W ) <br />
    </div>
    <input
      v-on:keydown.enter="signUp"
      type="password"
      id="pwcheck"
      style="position: relative; left: -23px"
      @keyup="repwCheck"
      placeholder="PW를 다시 입력해주세요!"
    /><br /><br />
    <span
      id="alert-success"
      style="display: none; font-weight: bold; color: blue"
      >비밀번호가 일치합니다.</span
    >
    <span id="alert-danger" style="display: none; font-weight: bold; color: red"
      >비밀번호가 일치하지 않습니다.</span
    >

    <br />
    <button
      v-on:click="signUp"
      id="allClear"
      style="border: 1px solid black; width: 67pt; height: 35pt"
    >
      가입하기
    </button>
    <p>또는 <router-link to="/login">로그인으로 돌아가기</router-link></p>
    <br />
    <br />
  </div>
</template>

<script>
import $ from "jquery";
import axios from "axios";

export default {
  data: function() {
    return {
      user: {
        userid: "",
        name: "",
        password: ""
      }
    };
  },

  methods: {
    //최종 가입 버튼
    signUp() {
      var id = $("#idClear").css("visibility");
      var name = $("#nameClear").css("visibility");
      var pw = $("#pwClear").css("visibility");
      var aler = $("#alert-success").css("display");

      if (
        id === "visible" &&
        name === "visible" &&
        pw === "visible" &&
        aler === "inline-block"
      ) {
        this.$http
          .post("/api/member/signup", {
            id: this.user.userid,
            name: this.user.name,
            password: this.user.password
          })
          .then(res => {
            if (res.data === true) {
              alert('회원가입을 성공하였습니다.');
              this.$router.push("/");
            }
            if (res.data === false) {
              alert('회원가입을 실패하였습니다.');
              this.$router.push("/signup");
            }
          });
      } else {
        alert("회원 정보를 다시 확인해주세요!");
      }
    },
    //아이디 확인 버튼
    idCheck() {
      var idReg = /^[A-Za-z]+[A-Za-z0-9]{3,15}$/g;
      // var idReg = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;
      if (!idReg.test($("input[name=uid]").val())) {
        alert(
          "이메일을 다시 한번 확인 해 주세요."
        );
      } else {
        this.$http
          .post("/api/member/idCheck", {
            id: this.user.userid
          })
          .then(res => {
            if (res.data.success == false) {
              alert(res.data.message);
              $("#idClear").css("visibility", "visible");
              $("#idCheckClear").css("visibility", "hidden");
              $("#id")
                .attr("disabled", true)
                .attr("readonly", false);
            }
            if (res.data.success == true) {
              alert(res.data.message);
            }
          })
          .catch(error => console.log(error.response.data.message));
      }
    },
    //이름 확인
    nameCheck() {
      var regexp = /[a-z0-9]|[ [\]{}()<>?|`~!@#$%^&*-_+=,.;:'"\\]/g;
      var v = $("#name").val();
      if (regexp.test(v)) {
        alert("한글만 입력가능 합니다.");
        $("#nameClear").css("visibility", "hidden");
        $("#nameFalse").css("visibility", "visible");
        $("#name").val(v.replace(regexp, ""));
      } else {
        $("#nameClear").css("visibility", "visible");
        $("#nameFalse").css("visibility", "hidden");
      }
      if (v == "") {
        $("#nameClear").css("visibility", "hidden");
        $("#nameFalse").css("visibility", "visible");
      }
    },
    //비밀 번호 확인
    pwCheck() {
      var pwd1 = $("#pw").val();
      var pwd2 = $("#pwcheck").val();
      var pwReg = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{4,15}$/;

      if (!pwReg.test($("input[name=upw]").val())) {
        $("#pwClear").css("visibility", "hidden");
        $("#pwFalse").css("visibility", "visible");
        return;
      } else {
        $("#pwClear").css("visibility", "visible");
        $("#pwFalse").css("visibility", "hidden");
      }
      if (pwd1 != "" && pwd2 == "") {
        null;
      } else if (pwd1 != "" || pwd2 != "") {
        if (pwd1 == pwd2) {
          $("#alert-success").css("display", "inline-block");
          $("#alert-danger").css("display", "none");
        } else {
          $("#alert-success").css("display", "none");
          $("#alert-danger").css("display", "inline-block");
        }
      }
    },
    //비밀 번호 재확인
    repwCheck() {
      var pwd1 = $("#pw").val();
      var pwd2 = $("#pwcheck").val();

      if (pwd1 != "" && pwd2 == "") {
        null;
      } else if (pwd1 != "" || pwd2 != "") {
        if (pwd1 == pwd2) {
          $("#alert-success").css("display", "inline-block");
          $("#alert-danger").css("display", "none");
        } else {
          $("#alert-success").css("display", "none");
          $("#alert-danger").css("display", "inline-block");
        }
      }
    }
  }
};
</script>
<style scoped>
img {
  width: 10%;
  vertical-align: middle;
}

.sign-up {
  margin-top: 40px;
  text-align: center;
}

input {
  margin: 0px 0;
  width: 25%;
  padding: 15px;
}

button {
  margin-top: 20px;
  width: 10%;
  cursor: pointer;
  border: 1px;
  background-color: white;
}

p {
  margin-top: 60px;
  margin-bottom: 50px;
  font-size: 15px;
  color: green;
}
p a {
  text-decoration: underline;
  cursor: pointer;
  color: #df0174;
}
</style>
